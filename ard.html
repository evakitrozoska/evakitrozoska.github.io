<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MIDI Theremin with Arduino</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- Topbar -->
<div class="topbar" id="topbar">
  <span class="name">Projects</span>
  <a href="index.html" class="back-btn">‚Üê Back</a>
</div>

<!-- Main content -->
<div class="main">
    <div class="project-detail">
        <h1>MIDI Theremin with Arduino</h1>

        <!-- Image Carousel -->
        <div class="project-img" id="carousel-container">
            <img id="carousel-image" src="" alt="Project Image">
            <a id="prev-btn" class="carousel-arrow">&#10094;</a>
            <a id="next-btn" class="carousel-arrow">&#10095;</a>
        </div>

        <!-- Description -->
        <p>
            This is my first project in microcontrollers. It's a MIDI instrument played in real time: 
            as a <b>theremin</b> and with <b>potentiometer knobs</b>. One hand controls <b>pitch</b>, the other <b>volume</b>. 
            Notes are quantized and you can choose different modes: 
            <i>major, minor, Lydian, Dorian, Mixolydian, Phrygian</i>. Buttons provide extra functions, including recording.
        </p>

        <p>
            A challenge: <i>How do I send MIDI signals from Arduino to a DAW?</i> I used <a href="https://www.tobias-erichsen.de/software/loopmidi.html" target="_blank"><b>LoopMIDI</b></a> 
            for virtual ports and <a href="https://edharmasiri.github.io/hairless-midiserial-with-minimize-to-tray/" target="_blank"><b>Hairless MIDI</b></a> to send signals. 
            DAW: <b>Cubase 12</b>.
        </p>

        <!-- Components -->
        <h2>Components</h2>
        <p>
            Arduino Uno board,<br>
            2x potentiometers,<br>
            LED + resistor,<br>
            4 buttons,<br>
            2x HC-SR04 sensors,<br>
            LED display,<br>
            Breadboard.
        </p>

        <!-- Code -->
        <h2>Code</h2>
        <section id="midi-controller">
            <div class="section">
                <h3>Input handling</h3>
                <p>
                  Reads potentiometers and ultrasonic sensors. Uses <strong>time-of-flight</strong> to map distances to notes/volume. Buttons are debounced.
                </p>
            </div>
            <div class="section">
                <h3>State management</h3>
                <p>
                  Keeps state variables for current/previous note, active scale, input mode. Scales are stored in a <strong>LUT</strong> for fast mapping.
                </p>
            </div>
            <div class="section">
                <h3>MIDI output & feedback</h3>
                <p>
                  Sends <strong>MIDI note-on/off</strong>. LED indicates recording.
                </p>
            </div>
            <div class="section">
                <h3>Timing & loop</h3>
                <p>
                  Main loop updates inputs at intervals for smooth response and debouncing.
                </p>
            </div>
        </section>

        <!-- Tags -->
        <div class="tags">
            <span>Arduino</span>
            <span>MIDI</span>
            <span>Electronics</span>
            <span>Embedded Systems</span>
        </div>

        <!-- Future Improvements -->
        <h2>Future Improvements / Tips</h2>
        <p>
            Use higher-precision sensors. HC-SR04 sensors were not very accurate for fine gestures. Better ultrasonic or optical sensors improve responsiveness and playability.
        </p>
    </div>
</div>

<script>
    // Shrink topbar on scroll
    const topbar = document.getElementById('topbar');
    window.addEventListener('scroll', () => {
      topbar.classList.toggle('shrink', window.scrollY > 20);
    });

    // Carousel
    const images = [
      "https://raw.githubusercontent.com/evakitrozoska/evakitrozoska.github.io/main/9.png",
      "https://raw.githubusercontent.com/evakitrozoska/evakitrozoska.github.io/main/8.png",
      "https://raw.githubusercontent.com/evakitrozoska/evakitrozoska.github.io/main/7.png"
    ];
    let currentIndex = 0;
    const imgElement = document.getElementById("carousel-image");
    const container = document.getElementById("carousel-container");

    function setContainerAspect(imgSrc) {
        const probe = new Image();
        probe.src = imgSrc;
        probe.onload = () => {
            const ratioPercent = (probe.height / probe.width) * 100;
            container.style.setProperty('--padding-top', ratioPercent + '%');
        };
        probe.onerror = () => container.style.setProperty('--padding-top', '56.25%');
    }

    function showImage(i) {
        currentIndex = (i + images.length) % images.length;
        imgElement.src = images[currentIndex];
        setContainerAspect(images[currentIndex]);
    }

    document.getElementById("prev-btn").onclick = () => showImage(currentIndex - 1);
    document.getElementById("next-btn").onclick = () => showImage(currentIndex + 1);

    // Initialize first image
    document.addEventListener('DOMContentLoaded', () => showImage(0));
</script>

</body>
</html>
